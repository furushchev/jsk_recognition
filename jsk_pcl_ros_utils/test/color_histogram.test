<launch>
  <arg name="cloud_input" default="/right_hand_camera/depth_registered/points" />

  <node name="rosbag_play"
        pkg="rosbag" type="play"
        args="$(find jsk_pcl_ros_utils)/sample/data/2017-02-05-16-11-09_shelf_bin.bag --clock --loop">
  </node>
  <include file="$(find openni2_launch)/launch/openni2.launch">
    <arg name="camera" value="right_hand_camera"/>
    <arg name="load_driver" value="false"/>
    <arg name="depth_registration" value="true"/>
  </include>

  <node name="indices"
        pkg="jsk_pcl_ros_utils" type="pointcloud_to_cluster_point_indices">
    <remap from="~input" to="$(arg cloud_input)"/>
  </node>

  <node name="color_histogram"
        pkg="jsk_pcl_ros_utils" type="color_histogram">
    <remap from="~input" to="$(arg cloud_input)"/>
    <remap from="~input/indices" to="indices/output" />
    <rosparam>
      bin_size: 10
      histogram_policy: 0
    </rosparam>
  </node>

  <node name="color_histogram_filter"
        pkg="jsk_pcl_ros_utils" type="color_histogram_filter">
    <remap from="~input" to="color_histogram/output" />
    <remap from="~input/indices" to="indices/output" />
    <rosparam>
      bin_size: 10
      distance_threshold: 1.0
      reference_histogram: [0.4496940076351166, 0.022353515028953552, 0.021087240427732468, 0.01058268267661333, 0.023007811978459358, 0.16684244573116302, 0.16969726979732513, 0.05753906071186066, 0.027093099430203438, 0.052102863788604736]
    </rosparam>
  </node>

  <node name="color_histogram_classifier"
        pkg="jsk_pcl_ros_utils" type="color_histogram_classifier">
    <remap from="~input/array" to="color_histogram/output" />
    <rosparam>
      label_names:
        - test
      histograms:
        test: [0.4496940076351166, 0.022353515028953552, 0.021087240427732468, 0.01058268267661333, 0.023007811978459358, 0.16684244573116302, 0.16969726979732513, 0.05753906071186066, 0.027093099430203438, 0.052102863788604736]
    </rosparam>
  </node>

  <node name="color_histogram_visualizer"
        pkg="jsk_pcl_ros_utils" type="visualize_color_histogram.py">
    <remap from="~input/array" to="color_histogram/output"/>
    <rosparam>
      histogram_index: 0
      histogram_policy: 0
    </rosparam>
  </node>

  <test test-name="test_color_histogram_filter" pkg="rostest" type="hztest"
        time-limit="10">
    <rosparam>
      topic: color_histogram_filter/output
      hz: 15
      hzerror: 14
      test_duration: 5.0
      wait_time: 5.0
    </rosparam>
  </test>

  <test test-name="test_color_histogram_classifier" pkg="rostest" type="hztest"
        time-limit="10">
    <rosparam>
      topic: color_histogram_classifier/output
      hz: 15
      hzerror: 14
      test_duration: 5.0
      wait_time: 5.0
    </rosparam>
  </test>

  <test test-name="test_color_histogram_visualizer" pkg="rostest" type="hztest"
        time-limit="10">
    <rosparam>
      topic: color_histogram_visualizer/output
      hz: 15
      hzerror: 14
      test_duration: 5.0
      wait_time: 5.0
    </rosparam>
  </test>
</launch>
